# JSR Template Inlining - Transformation Example

## Before (Development with Text Imports)

**File: `src/template-processor.ts`**

```typescript
import { vento } from "jsr:@vento/vento@1.12.10";
import typescriptTemplate from "../templates/typescript.vto" with { type: "text" };
import jsonTemplate from "../templates/json.vto" with { type: "text" };
import yamlTemplate from "../templates/yaml.vto" with { type: "text" };
import textTemplate from "../templates/text.vto" with { type: "text" };

export class TemplateProcessor {
  private engine: ReturnType<typeof vento>;

  constructor() {
    this.engine = vento({
      autoescape: false,
      dataVarname: "data",
    });
  }

  async processTypescript(data: TemplateData): Promise<string> {
    const result = await this.engine.runString(typescriptTemplate, data);
    return result.content;
  }
  // ... more methods
}
```

## After (Built for JSR)

**File: `build/src/template-processor.ts`**

```typescript
import { vento } from "jsr:@vento/vento@1.12.10";
// Inlined from ../templates/typescript.vto
const typescriptTemplate = `/**
 * Version information for {{ project.name }}
 * Generated by Nagare on {{ buildDate }}
 * 
 * Note: This template generates TypeScript code, not HTML.
 * The |> safe filter is used to output raw values without escaping.
 */

export const VERSION = "{{ version }}";

export const BUILD_INFO = {
  buildDate: "{{ buildDate }}",
  gitCommit: "{{ gitCommit }}",
  buildEnvironment: "{{ environment }}",
  versionComponents: {
    major: {{ versionComponents.major |> safe }},
    minor: {{ versionComponents.minor |> safe }},
    patch: {{ versionComponents.patch |> safe }},
    prerelease: {{ if versionComponents.prerelease }}{{ versionComponents.prerelease |> jsonStringify |> safe }}{{ else }}null{{ /if }},
  },
} as const;

export const APP_INFO = {
  name: "{{ project.name }}",
  description: "{{ project.description }}",
  repository: "{{ project.repository }}",
  {{- if project.author }}
  author: "{{ project.author }}",
  {{- /if }}
  {{- if project.homepage }}
  homepage: "{{ project.homepage }}",
  {{- /if }}
  {{- if project.license }}
  license: "{{ project.license }}",
  {{- /if }}
} as const;

{{- if metadata }}
export const APP_METADATA = {{ metadata |> jsonStringify |> safe }} as const;
{{- else }}
export const APP_METADATA = {} as const;
{{- /if }}

{{- if releaseNotes }}
export const RELEASE_NOTES = {{ releaseNotes |> jsonStringify |> safe }} as const;
{{- else }}
export const RELEASE_NOTES = {} as const;
{{- /if }}`;
// Inlined from ../templates/json.vto
const jsonTemplate = `{
  "version": "{{ version }}",
  {{- if description }}
  "description": "{{ description }}",
  {{- /if }}
  {{- if project.author }}
  "author": "{{ project.author }}",
  {{- /if }}
  {{- if project.license }}
  "license": "{{ project.license }}",
  {{- /if }}
  {{- if buildInfo }}
  "buildInfo": {
    "date": "{{ buildDate }}",
    "commit": "{{ gitCommit }}"
  },
  {{- /if }}
  {{- if versionComponents }}
  "versionComponents": {
    "major": {{ versionComponents.major |> safe }},
    "minor": {{ versionComponents.minor |> safe }},
    "patch": {{ versionComponents.patch |> safe }}
    {{- if versionComponents.prerelease }},
    "prerelease": {{ versionComponents.prerelease |> jsonStringify |> safe }}
    {{- /if }}
  },
  {{- /if }}
  {{- if metadata }}
  "metadata": {{ metadata |> jsonStringify |> safe }},
  {{- /if }}
  "lastModified": "{{ buildDate }}"
}`;
// Inlined from ../templates/yaml.vto
const yamlTemplate = `version: {{ version }}
{{- if description }}
description: {{ description }}
{{- /if }}
{{- if project.author }}
author: {{ project.author }}
{{- /if }}
{{- if project.license }}
license: {{ project.license }}
{{- /if }}
{{- if buildInfo }}
buildInfo:
  date: {{ buildDate }}
  commit: {{ gitCommit }}
{{- /if }}
{{- if versionComponents }}
versionComponents:
  major: {{ versionComponents.major |> safe }}
  minor: {{ versionComponents.minor |> safe }}
  patch: {{ versionComponents.patch |> safe }}
  {{- if versionComponents.prerelease }}
  prerelease: {{ versionComponents.prerelease |> jsonStringify |> safe }}
  {{- /if }}
{{- /if }}
{{- if metadata }}
metadata: {{ metadata |> jsonStringify |> safe }}
{{- /if }}
lastModified: {{ buildDate }}`;
// Inlined from ../templates/text.vto
const textTemplate = `Version: {{ version }}
Date: {{ buildDate }}
{{- if gitCommit }}
Commit: {{ gitCommit }}
{{- /if }}

{{- if description }}
{{ description }}
{{- /if }}

{{- if releaseNotes }}
Release Notes:
{{ releaseNotes }}
{{- /if }}`;

export class TemplateProcessor {
  private engine: ReturnType<typeof vento>;

  constructor() {
    this.engine = vento({
      autoescape: false,
      dataVarname: "data",
    });
  }

  async processTypescript(data: TemplateData): Promise<string> {
    const result = await this.engine.runString(typescriptTemplate, data);
    return result.content;
  }
  // ... more methods
}
```

## Key Points

1. **No functional changes** - The code works exactly the same
2. **Type safety maintained** - TypeScript still knows these are strings
3. **JSR compatible** - No text imports to cause issues
4. **Slightly larger file** - But templates no longer need to be bundled separately
5. **Better performance** - No file I/O needed to load templates

## Character Escaping

The script properly handles:

- Backticks (`` ` ``) → `\``
- Backslashes (`\`) → `\\`
- Template literals (`${`) → `\${`

This ensures the inlined templates work correctly as JavaScript template literals.
