#!/bin/sh
# 05-type-check - Strict TypeScript type checking

set -e

# Source common functions
. "$(dirname "$0")/../lib/common.sh" 2>/dev/null || true

echo "  🔍 TypeScript Type Checking..."

# Get staged TypeScript files, excluding test files for strict checking
STAGED_TS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.ts$' | grep -v '_test\.ts$' | grep -v '\.test\.ts$' | grep -v '^tests/' || true)

if [ -z "$STAGED_TS_FILES" ]; then
  echo "     No TypeScript files to check"
  exit 0
fi

# Run type checking on main source files only (not test files)
if deno check cli.ts mod.ts 2>/dev/null; then
  echo "     ✅ Type checking passed"
else
  echo "     ❌ Type checking failed"
  echo "     Run 'deno check cli.ts mod.ts' for details"
  exit 1
fi

exit 0